#!/usr/bin/env python3

import argparse
import subprocess
import sys
import os
from pathlib import Path

def main():
    ap = argparse.ArgumentParser()
    ap.add_argument('template', help='Template image')
    ap.add_argument('checkbox_locations', help='SVG of template image, with checkbox locations')
    ap.add_argument('image', help='Image to process')
    ap.add_argument('-d', dest='debug', help='Debug marks to file')
    args = ap.parse_args()


    # Step 0: Sort out some path names
    local_path = os.path.dirname(os.path.abspath(__file__)) # path to this script

    input_image_name = Path(args.image).stem
    output_path = Path.cwd() / "ouput"

    # Step 1: Call the alignment script
    aligned_output_path = output_path / (Path(args.image).stem + "_aligned.jpg")
    matched_output_path = output_path / (Path(args.image).stem + "_matched.jpg")
    print(aligned_output_path)
    print(matched_output_path)
    subprocess.run([local_path + "/align", args.template, args.image, aligned_output_path, matched_output_path])

    # Step 2: Call the OMR script



if __name__ == '__main__':
    sys.exit(main())
